<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Calendar Colorizer - Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .user-selector {
            margin: 20px 0;
        }
        
        .user-selector label {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .user-selector select {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .user-selector button {
            padding: 8px 16px;
            margin-left: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .user-selector button:hover {
            background: #45a049;
        }
        
        #prevMonth, #nextMonth {
            background: #2196F3;
        }
        
        #prevMonth:hover, #nextMonth:hover {
            background: #0b7dda;
        }
        
        #currentMonthDisplay {
            margin: 0 20px;
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Mock calendar styles */
        .calendar-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .calendar-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .navigation_title_text {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .calendar {
            width: 100%;
            border-collapse: collapse;
        }
        
        .calendar th {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
        }
        
        .calendar td {
            border: 1px solid #ddd;
            padding: 15px;
            text-align: center;
            height: 80px;
            vertical-align: top;
            background-color: white;
            cursor: pointer;
        }
        
        .calendar td:hover {
            background-color: #f0f0f0;
        }
        
        .calendar td.other-month {
            background-color: #f9f9f9;
            color: #999;
        }
        
        .day-number {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .legend {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend h3 {
            margin-top: 0;
        }
        
        .legend-items {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .legend-color.level-0 { background-color: white; }
        .legend-color.level-1 { background-color: #b8e6b8; }
        .legend-color.level-2 { background-color: #80d480; }
        .legend-color.level-3 { background-color: #4dac4d; }
        .legend-color.level-4 { background-color: #2d862d; }
        .legend-color.level-5 { background-color: #1a5c1a; }
    </style>
</head>
<body>
    <div class="header">
        <h1>User Calendar Colorizer - Example</h1>
        <p>This example demonstrates how the user_calendar_colorizer.js script works with an existing calendar.</p>
        
        <div class="user-selector">
            <label for="userSelect">Select User:</label>
            <select id="userSelect">
                <option value="">Choose a user...</option>
                <option value="12552282">Student 12552282</option>
                <option value="12552287">Student 12552287</option>
                <option value="10060334">Student 10060334</option>
                <option value="12552289">Student 12552289</option>
                <option value="10060343">Student 10060343</option>
            </select>
            <button id="colorizeBtn">Color Calendar</button>
        </div>
        
        <div class="user-selector">
            <button id="prevMonth">← Previous Month</button>
            <span id="currentMonthDisplay">October 2025</span>
            <button id="nextMonth">Next Month →</button>
        </div>
    </div>

    <div class="calendar-container">
        <div class="calendar-header">
            <span class="navigation_title_text">October 2025</span>
        </div>
        
        <table class="calendar">
            <thead>
                <tr>
                    <th>Sun</th>
                    <th>Mon</th>
                    <th>Tue</th>
                    <th>Wed</th>
                    <th>Thu</th>
                    <th>Fri</th>
                    <th>Sat</th>
                </tr>
            </thead>
            <tbody id="calendarBody">
                <!-- Calendar will be generated by JavaScript -->
            </tbody>
        </table>
    </div>

    <div class="legend">
        <h3>MA Count Legend</h3>
        <div class="legend-items">
            <div class="legend-item">
                <span class="legend-color level-0"></span>
                <span>0 MAs</span>
            </div>
            <div class="legend-item">
                <span class="legend-color level-1"></span>
                <span>1 MA</span>
            </div>
            <div class="legend-item">
                <span class="legend-color level-2"></span>
                <span>2 MAs</span>
            </div>
            <div class="legend-item">
                <span class="legend-color level-3"></span>
                <span>3 MAs</span>
            </div>
            <div class="legend-item">
                <span class="legend-color level-4"></span>
                <span>4 MAs</span>
            </div>
            <div class="legend-item">
                <span class="legend-color level-5"></span>
                <span>5+ MAs</span>
            </div>
        </div>
    </div>

    <!-- Include the colorizer script -->
    <script src="user_calendar_colorizer.js"></script>
    
    <!-- Demo-specific script -->
    <script>
        // Calendar state
        let currentMonth = 9; // October (0-indexed)
        let currentYear = 2025;
        let currentUserId = null;

        // Month names
        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        // Render calendar for current month
        function renderCalendar() {
            const calendarBody = document.getElementById('calendarBody');
            const monthDisplay = document.querySelector('.navigation_title_text');
            const currentMonthDisplay = document.getElementById('currentMonthDisplay');
            
            // Update month display
            const monthText = `${monthNames[currentMonth]} ${currentYear}`;
            monthDisplay.textContent = monthText;
            currentMonthDisplay.textContent = monthText;
            
            // Clear calendar
            calendarBody.innerHTML = '';
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Get previous month's last days
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            
            let html = '';
            let dayCounter = 1;
            let nextMonthDay = 1;
            
            // Create 6 weeks (max needed for any month)
            for (let week = 0; week < 6; week++) {
                html += '<tr>';
                
                for (let day = 0; day < 7; day++) {
                    const cellIndex = week * 7 + day;
                    
                    if (cellIndex < startingDayOfWeek) {
                        // Previous month days
                        const prevDay = prevMonthLastDay - startingDayOfWeek + cellIndex + 1;
                        const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                        const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
                        const dateStr = `${prevYear}-${String(prevMonth + 1).padStart(2, '0')}-${String(prevDay).padStart(2, '0')}`;
                        html += `<td class="fc-day other-month" data-date="${dateStr}"><div class="day-number">${prevDay}</div></td>`;
                    } else if (dayCounter <= daysInMonth) {
                        // Current month days
                        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(dayCounter).padStart(2, '0')}`;
                        const isToday = (currentYear === new Date().getFullYear() && 
                                       currentMonth === new Date().getMonth() && 
                                       dayCounter === new Date().getDate());
                        html += `<td class="fc-day${isToday ? ' today' : ''}" data-date="${dateStr}"><div class="day-number">${dayCounter}</div></td>`;
                        dayCounter++;
                    } else {
                        // Next month days
                        const nextMonth = currentMonth === 11 ? 0 : currentMonth + 1;
                        const nextYear = currentMonth === 11 ? currentYear + 1 : currentYear;
                        const dateStr = `${nextYear}-${String(nextMonth + 1).padStart(2, '0')}-${String(nextMonthDay).padStart(2, '0')}`;
                        html += `<td class="fc-day other-month" data-date="${dateStr}"><div class="day-number">${nextMonthDay}</div></td>`;
                        nextMonthDay++;
                    }
                }
                
                html += '</tr>';
                
                // Stop if we've filled all days and next week would be all next month
                if (dayCounter > daysInMonth && nextMonthDay > 7) break;
            }
            
            calendarBody.innerHTML = html;
            
            // Re-apply colors if user is selected
            if (currentUserId && window.userCalendarColorizer) {
                window.userCalendarColorizer.refresh();
            }
        }

        // Handle manual user selection
        document.getElementById('colorizeBtn').addEventListener('click', async () => {
            const userId = document.getElementById('userSelect').value;
            
            if (!userId) {
                alert('Please select a user first');
                return;
            }
            
            currentUserId = userId;
            
            // Clear any existing colors first
            document.querySelectorAll('td.fc-day').forEach(cell => {
                cell.style.removeProperty('background-color');
                cell.removeAttribute('data-ma-count');
                cell.removeAttribute('title');
            });
            
            // Initialize colorizer for selected user
            await initUserCalendarColorizer(userId);
        });

        // Month navigation
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // Initial render
        renderCalendar();
    </script>
</body>
</html>
